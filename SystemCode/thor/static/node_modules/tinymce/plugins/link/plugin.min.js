(function(){(function(){var F=tinymce.util.Tools.resolve("tinymce.PluginManager"),G=tinymce.util.Tools.resolve("tinymce.util.VK"),e={assumeExternalTargets:function(a){return"boolean"===typeof a.link_assume_external_targets?a.link_assume_external_targets:!1},hasContextToolbar:function(a){return"boolean"===typeof a.link_context_toolbar?a.link_context_toolbar:!1},getLinkList:function(a){return a.link_list},hasDefaultLinkTarget:function(a){return"string"===typeof a.default_link_target},getDefaultLinkTarget:function(a){return a.default_link_target},
getTargetList:function(a){return a.target_list},setTargetList:function(a,b){a.settings.target_list=b},shouldShowTargetList:function(a){return!1!==a.target_list},getRelList:function(a){return a.rel_list},hasRelList:function(a){return void 0!==a.rel_list},getLinkClassList:function(a){return a.link_class_list},hasLinkClassList:function(a){return void 0!==a.link_class_list},shouldShowLinkTitle:function(a){return!1!==a.link_title},allowUnsafeLinkTarget:function(a){return"boolean"===typeof a.allow_unsafe_link_target?
a.allow_unsafe_link_target:!1}},H=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),w=tinymce.util.Tools.resolve("tinymce.Env"),I={open:function(a){if(!w.ie||10<w.ie){var b=document.createElement("a");b.target="_blank";b.href=a;b.rel="noreferrer noopener";a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);document.body.appendChild(b);b.dispatchEvent(a);document.body.removeChild(b)}else if(b=window.open("","_blank"))b.opener=null,b=b.document,
b.open(),b.write('<meta http-equiv="refresh" content="0; url='+H.DOM.encode(a)+'">'),b.close()}},m=tinymce.util.Tools.resolve("tinymce.util.Tools"),B=function(a,b){var c=["noopener"],d=a?a.split(/\s+/):[],e=function(a){a=f(a);return a.length?a.concat(c):c},f=function(a){return a.filter(function(a){return-1===m.inArray(c,a)})};d=b?e(d):f(d);return d.length?m.trim(d.sort().join(" ")):null},C=function(a,b){b=b||a.selection.getNode();return p(b)?a.dom.select("a[href]",b)[0]:a.dom.getParent(b,"a[href]")},
D=function(a){return a&&"A"===a.nodeName&&a.href},p=function(a){return a&&"FIGURE"===a.nodeName&&/\bimage\b/i.test(a.className)},h={link:function(a,b){return function(c){a.undoManager.transact(function(){var d=a.selection.getNode(),n=C(a,d),f={href:c.href,target:c.target?c.target:null,rel:c.rel?c.rel:null,"class":c["class"]?c["class"]:null,title:c.title?c.title:null};e.hasRelList(a.settings)||!1!==e.allowUnsafeLinkTarget(a.settings)||(f.rel=B(f.rel,"_blank"===f.target));c.href===b.href&&(b.attach(),
b={});if(n)a.focus(),c.hasOwnProperty("text")&&("innerText"in n?n.innerText=c.text:n.textContent=c.text),a.dom.setAttribs(n,f),a.selection.select(n),a.undoManager.add();else if(p(d)){if(d=a.dom.select("img",d)[0])f=a.dom.create("a",f),d.parentNode.insertBefore(f,d),f.appendChild(d)}else c.hasOwnProperty("text")?a.insertContent(a.dom.createHTML("a",f,a.dom.encode(c.text))):a.execCommand("mceInsertLink",!1,f)})}},unlink:function(a){return function(){a.undoManager.transact(function(){var b=a.selection.getNode();
if(p(b)){var c;if(c=a.dom.select("img",b)[0])if(b=a.dom.getParents(c,"a[href]",b)[0])b.parentNode.insertBefore(c,b),a.dom.remove(b)}else a.execCommand("unlink")})}},isLink:D,hasLinks:function(a){return 0<m.grep(a,D).length},isOnlyTextSelected:function(a){return!/</.test(a)||/^<a [^>]+>[^<]+<\/a>$/.test(a)&&-1!==a.indexOf("href=")?!0:!1},getAnchorElement:C,getAnchorText:function(a,b){return(b?b.innerText||b.textContent:a.getContent({format:"text"})).replace(/\uFEFF/g,"")},toggleTargetRules:B};tinymce.util.Tools.resolve("tinymce.util.Delay");
var J=tinymce.util.Tools.resolve("tinymce.util.XHR"),E={},K=function(a,b){var c=e.getLinkList(a.settings);"string"===typeof c?J.send({url:c,success:function(c){b(a,JSON.parse(c))}}):"function"===typeof c?c(function(c){b(a,c)}):b(a,c)},x=function(a,b,c){var d=function(a,c){c=c||[];m.each(a,function(a){var e={text:a.text||a.title};a.menu?e.menu=d(a.menu):(e.value=a.value,b&&b(e));c.push(e)});return c};return d(a,c||[])},L=function(a,b){var c={},d=a.dom,g,f,v,p,r,t,q,u=function(a){var c=y.find("#text");
(!c.value()||a.lastControl&&c.value()===a.lastControl.text())&&c.value(a.control.text());y.find("#href").value(a.control.value())},A=function(){g||!z||c.text||this.parent().parent().find("#text")[0].value(this.value())};var z=h.isOnlyTextSelected(a.selection.getContent());var k=h.getAnchorElement(a);c.text=g=h.getAnchorText(a.selection,k);c.href=k?d.getAttrib(k,"href"):"";k?c.target=d.getAttrib(k,"target"):e.hasDefaultLinkTarget(a.settings)&&(c.target=e.getDefaultLinkTarget(a.settings));if(q=d.getAttrib(k,
"rel"))c.rel=q;if(q=d.getAttrib(k,"class"))c["class"]=q;if(q=d.getAttrib(k,"title"))c.title=q;z&&(f={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){c.text=this.value()}});b&&(v={type:"listbox",label:"Link list",values:x(b,function(c){c.value=a.convertURL(c.value||c.url,"href")},[{text:"None",value:""}]),onselect:u,value:a.convertURL(c.href,"href"),onPostRender:function(){v=this}});if(e.shouldShowTargetList(a.settings)){void 0===e.getTargetList(a.settings)&&e.setTargetList(a,
[{text:"None",value:""},{text:"New window",value:"_blank"}]);var w={name:"target",type:"listbox",label:"Target",values:x(e.getTargetList(a.settings))}}e.hasRelList(a.settings)&&(p={name:"rel",type:"listbox",label:"Rel",values:x(e.getRelList(a.settings),function(b){!1===e.allowUnsafeLinkTarget(a.settings)&&(b.value=h.toggleTargetRules(b.value,"_blank"===c.target))})});e.hasLinkClassList(a.settings)&&(r={name:"class",type:"listbox",label:"Class",values:x(e.getLinkClassList(a.settings),function(c){c.value&&
(c.textStyle=function(){return a.formatter.getCssText({inline:"a",classes:[c.value]})})})});e.shouldShowLinkTitle(a.settings)&&(t={name:"title",type:"textbox",label:"Title",value:c.title});var y=a.windowManager.open({title:"Insert link",data:c,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:function(b){var d=b.meta||{};v&&v.value(a.convertURL(this.value(),"href"));m.each(b.meta,function(a,b){var d=y.find("#"+b);"text"===b?0===g.length&&(d.value(a),c.text=
a):d.value(a)});d.attach&&(E={href:this.value(),attach:d.attach});d.text||A.call(this)},onkeyup:A,onpaste:A,onbeforecall:function(a){a.meta=y.toJSON()}},f,t,function(c){var b=[];m.each(a.dom.select("a:not([href])"),function(a){(a=a.name||a.id)&&b.push({text:a,value:"#"+a,selected:-1!==c.indexOf("#"+a)})});if(b.length)return b.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:b,onselect:u}}(c.href),v,p,w,r],onSubmit:function(b){var d=e.assumeExternalTargets(a.settings),
f=h.link(a,E),k=h.unlink(a);b=m.extend({},c,b.data);var l=b.href;if(l){z&&b.text!==g||delete b.text;if(0<l.indexOf("@")&&-1===l.indexOf("//")&&-1===l.indexOf("mailto:"))b.href="mailto:"+l;else if(!0===d&&!/^\w+:/i.test(l)||!1===d&&/^\s*www[\.|\d\.]/i.test(l))b.href="http://"+l;f(b)}else k()}})},M={open:function(a){K(a,L)}},r=function(a,b){return a.dom.getParent(b,"a[href]")},t=function(a,b){if(b){var c=(c=b.getAttribute("data-mce-href"))?c:b.getAttribute("href");/^#/.test(c)?(c=a.$(c),c.length&&a.selection.scrollIntoView(c[0],
!0)):I.open(b.href)}},g={openDialog:function(a){return function(){M.open(a)}},gotoSelectedLink:function(a){return function(){t(a,r(a,a.selection.getStart()))}},leftClickedOnAHref:function(a){return function(b){var c;if(c=e.hasContextToolbar(a.settings))c=a.plugins.contextmenu,c=!(c&&c.isContextMenuVisible());if(c&&h.isLink(b)){b=a.selection;c=b.getRng();var d=c.startContainer;if(3===d.nodeType&&b.isCollapsed()&&0<c.startOffset&&c.startOffset<d.data.length)return!0}return!1}},setupGotoLinks:function(a){a.on("click",
function(b){var c=r(a,b.target);c&&G.metaKeyPressed(b)&&(b.preventDefault(),t(a,c))});a.on("keydown",function(b){var c=r(a,a.selection.getStart());c&&13===b.keyCode&&!0===b.altKey&&!1===b.shiftKey&&!1===b.ctrlKey&&!1===b.metaKey&&(b.preventDefault(),t(a,c))})},toggleActiveState:function(a){return function(){var b=this;a.on("nodechange",function(c){b.active(!a.readonly&&!!h.getAnchorElement(a,c.element))})}},toggleViewLinkState:function(a){return function(){var b=this,c=function(a){h.hasLinks(a.parents)?
b.show():b.hide()};h.hasLinks(a.dom.getParents(a.selection.getStart()))||b.hide();a.on("nodechange",c);b.on("remove",function(){a.off("nodechange",c)})}}},N={register:function(a){a.addCommand("mceLink",g.openDialog(a))}},O={setup:function(a){a.addShortcut("Meta+K","",g.openDialog(a))}},u={setupButtons:function(a){a.addButton("link",{active:!1,icon:"link",tooltip:"Insert/edit link",onclick:g.openDialog(a),onpostrender:g.toggleActiveState(a)});a.addButton("unlink",{active:!1,icon:"unlink",tooltip:"Remove link",
onclick:h.unlink(a),onpostrender:g.toggleActiveState(a)});a.addContextToolbar&&a.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:g.gotoSelectedLink(a)})},setupMenuItems:function(a){a.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:g.gotoSelectedLink(a),onPostRender:g.toggleViewLinkState(a),prependToContext:!0});a.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:g.openDialog(a),stateSelector:"a[href]",context:"insert",prependToContext:!0});a.addMenuItem("unlink",
{icon:"unlink",text:"Remove link",onclick:h.unlink(a),stateSelector:"a[href]"})},setupContextToolbars:function(a){a.addContextToolbar&&a.addContextToolbar(g.leftClickedOnAHref(a),"openlink | link unlink")}};F.add("link",function(a){u.setupButtons(a);u.setupMenuItems(a);u.setupContextToolbars(a);g.setupGotoLinks(a);N.register(a);O.setup(a)});return function(){}})()})();